from pathlib import Path

# Rebuild all revised JS and HTML logic into a working HTML page (dashboard) with improved functionality
dashboard_html = Path("/mnt/data/dashboard-simple-FIXED.html")
dashboard_content = """<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - TRI MAKMUR LABEL</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <div class="container mt-5">
    <h2>Dashboard</h2>
    <div id="dashboard-content" class="mt-4"></div>
    <div class="mt-4">
      <button class="btn btn-primary" onclick="showCreateOrder()">Create Order</button>
      <button class="btn btn-info" onclick="showStockManagement()">Stock Management</button>
      <button class="btn btn-warning" onclick="showUsers()">Manage Users</button>
      <button class="btn btn-secondary" onclick="showAllOrders()">All Orders</button>
    </div>
  </div>

<script>
// Redirect to login if not logged in
document.addEventListener('DOMContentLoaded', function() {
  const currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");
  if (!currentUser) {
    alert("Anda belum login!");
    window.location.href = "login.html";
    return;
  }

  document.getElementById("dashboard-content").innerHTML = `
    <p>Selamat datang, <strong>${currentUser.name}</strong> (${currentUser.role})</p>
  `;
});

// Action buttons logic
function showCreateOrder() {
  window.location.href = "create-order.html";
}
function showStockManagement() {
  const user = JSON.parse(localStorage.getItem("currentUser") || "null");
  if (user && (user.role === "admin" || user.role === "manager")) {
    window.location.href = "stock-management.html";
  } else {
    alert("Kamu tidak punya akses ke Stock Management!");
  }
}
function showUsers() {
  window.location.href = "user-manage.html";
}
function showAllOrders() {
  window.location.href = "work-orders.html";
}
</script>
</body>
</html>
"""

# Save revised dashboard HTML
dashboard_html.write_text(dashboard_content, encoding="utf-8")
str(dashboard_html)

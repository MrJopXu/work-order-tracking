<!-- Data and scripts -->
<script src="Data.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is logged in
        const userString = localStorage.getItem('currentUser');
        if (!userString) {
            alert('Anda belum login. Silakan login terlebih dahulu.');
            window.location.href = 'login.html';
            return;
        }
        
        const user = JSON.parse(userString);
        
        // Update UI with user info
        document.getElementById('user-name').textContent = user.name;
        document.getElementById('sidebar-user-name').textContent = user.name;
        document.getElementById('user-role').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
        
        // Show role-specific message
        let roleMessage = '';
        let actionButtons = '';
        
        switch(user.role) {
            case 'manager':
                roleMessage = 'Welcome to your dashboard! As a Manager, you have full access to all features of the system.';
                actionButtons = `
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-primary btn-block w-100">
                                <i class="fas fa-plus-circle me-2"></i> New Order
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-success btn-block w-100">
                                <i class="fas fa-file-export me-2"></i> Export Reports
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-info text-white btn-block w-100">
                                <i class="fas fa-users me-2"></i> Manage Users
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-warning text-dark btn-block w-100">
                                <i class="fas fa-cog me-2"></i> System Settings
                            </button>
                        </div>
                    </div>
                `;
                // Show all nav items for manager
                break;
                
            case 'admin':
                roleMessage = 'Welcome to your dashboard! As an Admin, you can manage PO entries and shipping information.';
                actionButtons = `
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-primary btn-block w-100">
                                <i class="fas fa-plus-circle me-2"></i> New Order
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-success btn-block w-100">
                                <i class="fas fa-truck me-2"></i> Update Shipping
                            </button>
                        </div>
                    </div>
                `;
                // Hide some nav items for admin
                document.getElementById('nav-reports').style.display = 'none';
                document.getElementById('sidebar-reports').style.display = 'none';
                document.getElementById('nav-settings').style.display = 'none';
                document.getElementById('sidebar-settings').style.display = 'none';
                break;
                
            case 'designer':
                roleMessage = 'Welcome to your dashboard! As a Designer, you can manage layout and film printing stages.';
                actionButtons = `
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-primary btn-block w-100">
                                <i class="fas fa-paint-brush me-2"></i> Layout Tasks
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-success btn-block w-100">
                                <i class="fas fa-film me-2"></i> Film Tasks
                            </button>
                        </div>
                    </div>
                `;
                // Hide some nav items for designer
                document.getElementById('nav-customers').style.display = 'none';
                document.getElementById('sidebar-customers').style.display = 'none';
                document.getElementById('nav-reports').style.display = 'none';
                document.getElementById('sidebar-reports').style.display = 'none';
                document.getElementById('nav-settings').style.display = 'none';
                document.getElementById('sidebar-settings').style.display = 'none';
                break;
                
            case 'production':
                roleMessage = 'Welcome to your dashboard! As a Production staff, you can manage production stages.';
                actionButtons = `
                    <div class="row">
                        <div class="col-12 mb-2">
                            <button class="btn btn-primary btn-block w-100">
                                <i class="fas fa-industry me-2"></i> View Production Tasks
                            </button>
                        </div>
                    </div>
                `;
                // Hide some nav items for production
                document.getElementById('nav-customers').style.display = 'none';
                document.getElementById('sidebar-customers').style.display = 'none';
                document.getElementById('nav-reports').style.display = 'none';
                document.getElementById('sidebar-reports').style.display = 'none';
                document.getElementById('nav-settings').style.display = 'none';
                document.getElementById('sidebar-settings').style.display = 'none';
                break;
                
            default:
                roleMessage = `Welcome to your ${user.role} dashboard.`;
        }
        
        document.getElementById('role-message').innerHTML = `<i class="fas fa-info-circle me-2"></i> ${roleMessage}`;
        document.getElementById('actions-container').innerHTML = actionButtons;
        
        // Load sample orders
        loadSampleOrders();
        
        // Handle logout
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        });
        
        // Initialize charts
        initializeCharts();
    });

    function loadSampleOrders() {
        const recentOrdersEl = document.getElementById('recent-orders');
        if (!recentOrdersEl || !sampleOrders) return;
        
        const orderKeys = Object.keys(sampleOrders);
        
        orderKeys.forEach(key => {
            const order = sampleOrders[key];
            const tr = document.createElement('tr');
            
            let statusClass = 'bg-secondary';
            if (order.status === 'Completed') {
                statusClass = 'bg-success';
            } else if (order.status === 'Production' || order.status === 'Layout') {
                statusClass = 'bg-warning';
            }
            
            tr.innerHTML = `
                <td>${order.trackingCode}</td>
                <td>Customer ${order.trackingCode.slice(-1)}</td>
                <td><span class="badge ${statusClass}">${order.status}</span></td>
                <td>${order.orderDate}</td>
                <td>
                    <button class="btn btn-sm btn-primary">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            `;
            
            recentOrdersEl.appendChild(tr);
        });
    }

    function initializeCharts() {
        // Only initialize if Chart.js is loaded and canvas elements exist
        if (typeof Chart === 'undefined') return;
        
        const ordersCtx = document.getElementById('ordersChart');
        const statusCtx = document.getElementById('statusPieChart');
        
        if (ordersCtx) {
            new Chart(ordersCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['January', 'February', 'March', 'April', 'May'],
                    datasets: [{
                        label: 'New Orders',
                        data: [15, 25, 20, 30, 25],
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    },
                    {
                        label: 'Completed Orders',
                        data: [10, 20, 15, 25, 20],
                        fill: false,
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        if (statusCtx) {
            new Chart(statusCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'In Progress', 'Pending'],
                    datasets: [{
                        data: [32, 24, 2],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(255, 205, 86, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgb(75, 192, 192)',
                            'rgb(255, 205, 86)',
                            'rgb(255, 99, 132)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    }
</script>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Order</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
  <div class="container mt-4">
    <h2>Create New Order</h2>
    <form onsubmit="submitOrder(event)">
      <div class="mb-3">
        <label class="form-label">Select SKU</label>
        <select class="form-select" id="sku-select" required></select>
      </div>
      <div class="mb-3">
        <label class="form-label">Select SKU</label>
        <select class="form-select" id="sku-select" required></select>
      </div>
      <div class="mb-3">
        <label class="form-label">Quantity</label>
        <input type="number" class="form-control" id="order-qty" required>
      </div>
      <button type="submit" class="btn btn-success">Create Order</button>
    </form>
  </div>

  <script>
    let inventory = [];

    document.addEventListener('DOMContentLoaded', () => {
      loadInventory();
      const select = document.getElementById('sku-select');
      inventory.forEach(item => {
        const option = document.createElement('option');
        option.value = item.sku;
        option.textContent = `${item.name} - ${item.sku} (stock: ${item.quantity})`;
        select.appendChild(option);
      });
    });

    function loadInventory() {
      const saved = localStorage.getItem('inventory');
      inventory = saved ? JSON.parse(saved) : [];
    }

    function saveInventory() {
      localStorage.setItem('inventory', JSON.stringify(inventory));
    }

    function submitOrder(e) {
      e.preventDefault();
      const sku = document.getElementById('sku-select').value;
      const qty = parseInt(document.getElementById('order-qty').value);
      const index = inventory.findIndex(item => item.sku === sku);

      if (index === -1 || inventory[index].quantity < qty) {
        alert('Invalid SKU or insufficient stock!');
        return;
      }

      inventory[index].quantity -= qty;
      saveInventory();
      alert('Order created and stock updated!');
      e.target.reset();
    }
  </script>

<script>
  let inventory = [];

  document.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('inventory');
    if (saved) {
      inventory = JSON.parse(saved);
      const select = document.getElementById('sku-select');
      if (select) {
        inventory.forEach(item => {
          const option = document.createElement('option');
          option.value = item.sku;
          option.textContent = `${item.name} - ${item.sku} (stock: ${item.quantity})`;
          select.appendChild(option);
        });
      }
    }
  });

  function updateStockAfterOrder(sku, qty) {
    const index = inventory.findIndex(item => item.sku === sku);
    if (index !== -1 && inventory[index].quantity >= qty) {
      inventory[index].quantity -= qty;
      localStorage.setItem('inventory', JSON.stringify(inventory));
    } else {
      alert("Stock not available or insufficient!");
    }
  }

  // Patch form submission if available
  document.addEventListener('submit', function(e) {
    const form = e.target;
    const skuEl = document.getElementById('sku-select');
    const qtyEl = document.getElementById('quantity') || document.getElementById('order-qty');
    if (skuEl && qtyEl) {
      const qty = parseInt(qtyEl.value);
      const sku = skuEl.value;
      updateStockAfterOrder(sku, qty);
    }
  });
</script>
</body>
</html>
